<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Card√°pio - Fa√ßa seu pedido</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Open+Sans&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(to bottom, #3b1f14, #1a0d08);
            color: white;
        }

        header {
            background: black;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
        }

        .container {
            max-width: 900px;
            margin: auto;
            padding: 20px;
        }

        .card {
            background: #c7741c;
            border-radius: 20px;
            display: flex;
            align-items: center;
            padding: 20px;
            margin-bottom: 20px;
            gap: 20px;
        }

        .card img {
            width: 130px;
            height: 130px;
            border-radius: 50%;
            object-fit: cover;
        }

        .info {
            flex: 1;
        }

        .info h3 {
            margin: 0 0 8px;
            font-family: 'Montserrat', sans-serif;
        }

        .info ul {
            margin: 0;
            padding-left: 18px;
        }

        .price {
            font-size: 22px;
            font-weight: bold;
        }

        button {
            background: black;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            transition: 0.3s;
        }

        button:hover {
            background: #222;
            transform: scale(1.05);
        }

        .pedido {
            background: #111;
            padding: 20px;
            border-radius: 16px;
            margin-top: 30px;
            border: 1px solid #c7741c;
        }

        .pedido h2 {
            margin-top: 0;
        }

        .item-carrinho {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            border-bottom: 1px dashed #444;
            padding-bottom: 4px;
        }

        select {
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            margin-top: 10px;
        }

        .btn-enviar {
            background: #28a745;
            width: 100%;
            font-weight: bold;
            margin-top: 20px;
            font-size: 18px;
        }
    </style>
</head>

<body>

<header>
    <h1>üçî Pe√ßa agora</h1>
    <p>Atendimento Imediato</p>
</header>

<div class="container">

<script>
 
  const autorizado = sessionStorage.getItem("cardapio_ok");
  const inicio = sessionStorage.getItem("cardapio_inicio");
  const mesaSessao = sessionStorage.getItem("mesa");

  const TEMPO_MAX = 30 * 60 * 1000;
  const agora = Date.now();

  if (!autorizado || !inicio || !mesaSessao) {
    document.body.innerHTML = `
      <h2>‚ùå Acesso encerrado</h2>
      <p>Escaneie o QR Code novamente.</p>
    `;
  }

 if (agora - inicio > TEMPO_MAX) {
    sessionStorage.clear();
    document.body.innerHTML = `
      <div style="text-align:center; margin-top:50px;">
        <h2>‚è±Ô∏è Sess√£o expirada</h2>
        <p>Por seguran√ßa, sua sess√£o de 2 minutos expirou.</p>
        <p>Escaneie o QR Code da mesa novamente.</p>
      </div>
    `;
    window.stop(); // Para o carregamento do restante da p√°gina
}
</script>



    <div class="card">
        <img src="https://images.unsplash.com/photo-1550547660-d9450f859349" alt="Hamb√∫rguer">
        <div class="info">
            <h3>Tradicional Carne Duplo</h3>
            <ul>
                <li>2 hamb√∫rgueres 180g</li>
                <li>Queijo e Salada</li>
            </ul>
        </div>
        <div>
            <div class="price">R$ 32,00</div>
            <button onclick="addPedido('Carne Duplo', 32)">Adicionar</button>
        </div>
    </div>

    <div class="card">
        <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd" alt="Hamb√∫rguer">
        <div class="info">
            <h3>Tradicional Carne</h3>
            <ul>
                <li>Hamb√∫rguer 180g</li>
                <li>Molho Especial</li>
            </ul>
        </div>
        <div>
            <div class="price">R$ 27,00</div>
            <button onclick="addPedido('Tradicional Carne', 27)">Adicionar</button>
        </div>
    </div>

    <div class="pedido">
        <h2>üßæ Seu pedido</h2>
        <div id="lista"></div>
        <hr>
        <div style="display: flex; justify-content: space-between; font-size: 20px;">
            <strong>Total:</strong>
            <strong>R$ <span id="total">0.00</span></strong>
        </div>
    </div>

    

    <button class="btn-enviar" onclick="enviarPedido()">üì§ ENVIAR PEDIDO</button>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAQy_vxGowwbjptqbGVYp_-_wa1eUYKvxE",
        authDomain: "cliente-mesa.firebaseapp.com",
        projectId: "cliente-mesa",
        storageBucket: "cliente-mesa.firebasestorage.app",
        messagingSenderId: "1026287310268",
        appId: "1:1026287310268:web:6557abdd6eb37b861fc7b9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let carrinho = [];
    let valorTotal = 0;

    // Fun√ß√£o para atualizar a interface do carrinho
    function atualizarInterface() {
        const listaElement = document.getElementById("lista");
        listaElement.innerHTML = "";

        carrinho.forEach(item => {
            const div = document.createElement("div");
            div.className = "item-carrinho";
            div.innerHTML = `<span>${item.nome}</span><span>R$ ${item.preco.toFixed(2)}</span>`;
            listaElement.appendChild(div);
        });

        document.getElementById("total").textContent = valorTotal.toFixed(2);
    }

    // Tornar fun√ß√µes globais para o 'onclick' do HTML
    window.addPedido = function(nome, preco) {
        carrinho.push({ nome, preco });
        valorTotal += preco;
        atualizarInterface();
    };

    window.enviarPedido = async function () {
        const mesaSelecionada = sessionStorage.getItem("mesa");

        if (!mesaSelecionada) {
  alert("‚ùå Mesa n√£o identificada. Escaneie o QR Code novamente.");
  return;
}


        if (carrinho.length === 0) {
            alert("üõí Seu carrinho est√° vazio!");
            return;
        }

        try {
            // Loop para salvar cada item na subcole√ß√£o conforme sua estrutura confirmada
            // Caminho: pedidos -> mesaX -> itens
            for (const item of carrinho) {
                await addDoc(collection(db, "pedidos", "mesa" + mesaSelecionada, "itens"), {
                    nome: item.nome,
                    preco: item.preco,
                    status: "novo",
                    criadoEm: serverTimestamp()
                });
            }

            // Limpa o carrinho ap√≥s o sucesso
            carrinho = [];
            valorTotal = 0;
            atualizarInterface();
            // Tirei document.getElementById("mesa").value = "";
            alert("üöÄ Pedido enviado com sucesso para a cozinha!");

        } catch (error) {
            console.error("Erro ao enviar pedido:", error);
            alert("‚ùå Erro ao enviar. Tente novamente.");
        }
    };
</script>

</body>
</html>
